<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="PendikISM Denetim">
<title>Pendik Ä°SM Denetim</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root{--bg:#f0ede8;--surface:#fff;--border:#d4cfc8;--text:#1a1814;--muted:#6b6560;--accent:#c0392b;--accent-light:#fdf0ef;--accent2:#2c3e50;--success:#27ae60;--r:4px;--shadow:0 1px 3px rgba(0,0,0,.08),0 4px 16px rgba(0,0,0,.04)}
  *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
  body{font-family:'IBM Plex Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
  header{background:var(--accent2);color:#fff;padding:14px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;box-shadow:0 2px 8px rgba(0,0,0,.2)}
  header h1{font-size:14px;font-weight:600;letter-spacing:.05em;text-transform:uppercase}
  header p{font-size:11px;opacity:.6;font-family:'IBM Plex Mono',monospace;margin-top:2px}
  .badge{background:var(--accent);font-size:11px;font-weight:600;padding:4px 10px;border-radius:2px}
  #user-bar{display:none;align-items:center;gap:10px;padding:10px 20px;background:rgba(44,62,80,.06);border-bottom:1px solid var(--border);font-size:13px;color:var(--muted)}
  #user-bar span{flex:1;font-weight:500;color:var(--text)}
  .btn-logout{background:none;border:none;font-size:12px;color:var(--accent);cursor:pointer;font-family:inherit;font-weight:500;padding:4px 8px}
  #auth-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:calc(100vh - 56px);padding:32px 24px;text-align:center}
  .auth-logo{width:72px;height:72px;background:var(--accent2);border-radius:12px;display:flex;align-items:center;justify-content:center;margin:0 auto 24px;font-size:32px}
  .auth-title{font-size:22px;font-weight:600;margin-bottom:6px}
  .auth-sub{font-size:14px;color:var(--muted);margin-bottom:28px;line-height:1.6}
  .auth-box{background:#fff;border:1px solid var(--border);border-radius:8px;padding:24px;width:100%;max-width:340px;box-shadow:var(--shadow)}
  .auth-label{font-size:11px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:6px;text-align:left}
  .auth-input{width:100%;border:1.5px solid var(--border);border-radius:var(--r);padding:12px 14px;font-size:16px;font-family:inherit;color:var(--text);background:#fff;outline:none;letter-spacing:.05em;-webkit-appearance:none}
  .auth-input:focus{border-color:var(--accent2)}
  .auth-hint{font-size:12px;color:var(--muted);margin-top:6px;text-align:left}
  .btn-giris{width:100%;margin-top:16px;padding:14px;background:var(--accent);color:#fff;border:none;border-radius:var(--r);font-size:15px;font-weight:600;font-family:inherit;cursor:pointer}
  .btn-giris:disabled{background:var(--border);cursor:not-allowed}
  .auth-error{margin-top:12px;padding:10px 14px;background:var(--accent-light);color:var(--accent);border-radius:var(--r);font-size:13px;font-weight:500;display:none}
  .auth-error.show{display:block}
  #app-screen{display:none;padding:20px;max-width:680px;margin:0 auto}
  .slabel{font-size:10px;font-weight:600;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);margin-bottom:8px;margin-top:20px}
  .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:16px;box-shadow:var(--shadow);margin-bottom:12px}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .fg{display:flex;flex-direction:column;gap:4px}
  .fg label{font-size:11px;font-weight:500;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
  input[type=text],input[type=date],textarea{width:100%;border:1px solid var(--border);border-radius:var(--r);padding:10px 12px;font-size:14px;font-family:inherit;color:var(--text);background:#fff;outline:none;transition:border-color .15s;-webkit-appearance:none}
  input:focus,textarea:focus{border-color:var(--accent2)}
  textarea{resize:none;min-height:200px;line-height:1.7;font-size:15px}
  .mic-row{display:flex;gap:10px;margin-top:10px}
  .btn-mic{display:flex;align-items:center;gap:8px;padding:12px 20px;border:none;border-radius:var(--r);font-size:14px;font-weight:600;font-family:inherit;cursor:pointer;flex:1;justify-content:center}
  .btn-start{background:var(--accent2);color:#fff}
  .btn-stop{background:var(--accent);color:#fff;display:none}
  .btn-clear{background:transparent;border:1px solid var(--border);color:var(--muted);padding:12px 16px;border-radius:var(--r);font-family:inherit;font-size:13px;cursor:pointer}
  .rec-ind{display:none;align-items:center;gap:8px;font-size:13px;color:var(--accent);font-weight:500;margin-top:8px;padding:8px 12px;background:var(--accent-light);border-radius:var(--r)}
  .rec-ind.on{display:flex}
  .dot{width:8px;height:8px;background:var(--accent);border-radius:50%;animation:pulse 1s infinite;flex-shrink:0}
  @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.8)}}
  .sub-label{font-size:11px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:var(--muted);margin:12px 0 8px}
  .imza-item{display:flex;align-items:center;gap:8px;margin-bottom:8px}
  .imza-item label{font-size:12px;font-weight:500;color:var(--muted);white-space:nowrap;min-width:110px}
  .imza-item input{flex:1}
  .btn-rm{background:none;border:none;color:var(--accent);font-size:20px;cursor:pointer;padding:2px 8px;line-height:1;flex-shrink:0}
  .btn-add{display:flex;align-items:center;gap:6px;padding:10px 14px;background:transparent;border:1.5px dashed var(--border);border-radius:var(--r);color:var(--muted);font-family:inherit;font-size:13px;cursor:pointer;width:100%;justify-content:center;margin-top:4px}
  .btn-add:hover{border-color:var(--accent2);color:var(--accent2)}
  .save-sec{padding:20px 0 40px}
  .btn-save{width:100%;padding:16px;background:var(--accent);color:#fff;border:none;border-radius:var(--r);font-size:16px;font-weight:600;font-family:inherit;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px}
  .btn-save:disabled{background:var(--border);cursor:not-allowed}
  .status{display:none;margin-top:12px;padding:12px 16px;border-radius:var(--r);font-size:14px;font-weight:500;text-align:center}
  .status.ok{background:#eafaf1;color:var(--success);border:1px solid #a9dfbf;display:block}
  .status.err{background:var(--accent-light);color:var(--accent);border:1px solid #f5b7b1;display:block}
  .th{text-align:center;padding-bottom:12px;border-bottom:1px solid var(--border);margin-bottom:16px}
  .th .kurum{font-size:12px;color:var(--muted);line-height:1.6}
  .th .baslik{font-size:16px;font-weight:600;letter-spacing:.1em;margin-top:6px}
</style>
</head>
<body>

<header>
  <div><h1>Pendik Ä°SM Denetim</h1><p>Pendik KaymakamlÄ±ÄŸÄ± Â· Ä°lÃ§e SaÄŸlÄ±k MÃ¼dÃ¼rlÃ¼ÄŸÃ¼</p></div>
  <div class="badge">TC</div>
</header>

<div id="user-bar">
  <span id="user-name-bar">ğŸ‘¤</span>
  <button class="btn-logout" onclick="cikisYap()">Ã‡Ä±kÄ±ÅŸ</button>
</div>

<div id="auth-screen">
  <div class="auth-logo">ğŸ“‹</div>
  <div class="auth-title">HoÅŸ Geldiniz</div>
  <div class="auth-sub">Sisteme eriÅŸmek iÃ§in<br>kayÄ±tlÄ± telefon numaranÄ±zÄ± girin.</div>
  <div class="auth-box">
    <label class="auth-label">Telefon NumarasÄ±</label>
    <input class="auth-input" id="input-tel" type="tel" placeholder="5XXXXXXXXX" maxlength="10" inputmode="numeric">
    <div class="auth-hint">BaÅŸÄ±nda 0 olmadan 10 haneli giriniz</div>
    <button class="btn-giris" id="btn-giris" onclick="girisYap()">GiriÅŸ Yap</button>
    <div class="auth-error" id="auth-error"></div>
  </div>
</div>

<div id="app-screen">
  <div class="slabel" style="margin-top:16px">Tutanak Bilgileri</div>
  <div class="card">
    <div class="th">
      <div class="kurum">T.C. PENDÄ°K KAYMAKAMLIÄI<br>Ä°lÃ§e SaÄŸlÄ±k MÃ¼dÃ¼rlÃ¼ÄŸÃ¼</div>
      <div class="baslik">DENETÄ°M TUTANAÄI</div>
    </div>
    <div class="grid2">
      <div class="fg"><label>Tarih</label><input type="date" id="f-tarih"></div>
      <div class="fg"><label>Denetlenen</label><input type="text" id="f-denetlenen" placeholder="Ad Soyad / Kurum"></div>
    </div>
    <div class="fg" style="margin-top:12px">
      <label>Konu</label>
      <input type="text" id="f-konu" placeholder="Sesle veya yazarak girin">
      <div class="mic-row">
        <button class="btn-mic btn-start" id="ms-konu" onclick="startDic('konu')">ğŸ¤ Sesle Gir</button>
        <button class="btn-mic btn-stop" id="mp-konu" onclick="stopDic('konu')">â¹ Durdur</button>
      </div>
      <div class="rec-ind" id="ri-konu"><div class="dot"></div>Konu dinleniyor...</div>
    </div>
  </div>

  <div class="slabel">Ä°mza Bilgileri</div>
  <div class="card">
    <div class="imza-item">
      <label>Ekip BaÅŸkanÄ±</label>
      <input type="text" id="f-baskani" placeholder="Ad Soyad">
    </div>
    <div class="sub-label">DenetÃ§iler</div>
    <div id="denetci-list">
      <div class="imza-item" id="d-0"><label>DenetÃ§i 1</label><input type="text" placeholder="Ad Soyad"></div>
      <div class="imza-item" id="d-1"><label>DenetÃ§i 2</label><input type="text" placeholder="Ad Soyad"><button class="btn-rm" onclick="rmDenetci(1)">Ã—</button></div>
    </div>
    <button class="btn-add" id="btn-add-d" onclick="addDenetci()">+ DenetÃ§i Ekle (max 5)</button>
  </div>

  <div class="slabel">Denetim NotlarÄ±</div>
  <div class="card">
    <textarea id="f-notlar" placeholder="ğŸ¤ Mikrofon butonuna basÄ±n ve konuÅŸun. Ä°mleci istediÄŸiniz yere alarak o noktadan dikte yapabilirsiniz."></textarea>
    <div class="mic-row">
      <button class="btn-mic btn-start" id="ms-notlar" onclick="startDic('notlar')">ğŸ¤ Dikte BaÅŸlat</button>
      <button class="btn-mic btn-stop" id="mp-notlar" onclick="stopDic('notlar')">â¹ Durdur</button>
      <button class="btn-clear" onclick="document.getElementById('f-notlar').value=''">Temizle</button>
    </div>
    <div class="rec-ind" id="ri-notlar"><div class="dot"></div>Dinleniyor â€” konuÅŸabilirsiniz...</div>
  </div>

  <div class="save-sec">
    <button class="btn-save" id="btn-save" onclick="kaydet()">ğŸ“¥ TutanaÄŸÄ± Ä°ndir (.docx)</button>
    <div class="status" id="status"></div>
  </div>
</div>

<script>
// â”€â”€ YETKÄ°LÄ° KULLANICILAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Yeni kullanÄ±cÄ± eklemek iÃ§in: { tel: '5XXXXXXXXX', ad: 'Ad Soyad' }
const KULLANICILAR = [
  { tel: '5453342151', ad: 'KÃ¼bra Ã–ZBABALIK' },
  { tel: '5417472345', ad: 'Ahmet YILMAZ' },
  // Buraya yeni kullanÄ±cÄ± ekle
];

// â”€â”€ DeÄŸiÅŸkenler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentUser = null;
let recs = {};
let dCount = 2;

// â”€â”€ GÄ°RÄ°Å â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function girisYap() {
  const tel = document.getElementById('input-tel').value.trim().replace(/\D/g,'');
  if (tel.length !== 10) {
    gosterHata('LÃ¼tfen 10 haneli telefon numarasÄ± girin.');
    return;
  }
  const found = KULLANICILAR.find(k => k.tel === tel);
  if (found) {
    currentUser = found;
    uygulamaGoster();
  } else {
    gosterHata('Bu numara yetkili deÄŸil veya sistemde kayÄ±tlÄ± deÄŸil.');
  }
}

function gosterHata(msg) {
  const el = document.getElementById('auth-error');
  el.textContent = msg;
  el.classList.add('show');
}

function uygulamaGoster() {
  document.getElementById('auth-screen').style.display = 'none';
  document.getElementById('app-screen').style.display = 'block';
  document.getElementById('user-bar').style.display = 'flex';
  document.getElementById('user-name-bar').textContent = 'ğŸ‘¤ ' + currentUser.ad;
  document.getElementById('f-tarih').value = new Date().toISOString().split('T')[0];
}

function cikisYap() {
  currentUser = null;
  document.getElementById('auth-screen').style.display = 'flex';
  document.getElementById('app-screen').style.display = 'none';
  document.getElementById('user-bar').style.display = 'none';
  document.getElementById('input-tel').value = '';
  document.getElementById('auth-error').classList.remove('show');
}

document.getElementById('input-tel').addEventListener('keydown', e => {
  if (e.key === 'Enter') girisYap();
});

// â”€â”€ DENETÃ‡I â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addDenetci() {
  if (dCount >= 5) return;
  const list = document.getElementById('denetci-list');
  const d = document.createElement('div');
  d.className = 'imza-item'; d.id = `d-${dCount}`;
  d.innerHTML = `<label>DenetÃ§i ${dCount+1}</label><input type="text" placeholder="Ad Soyad"><button class="btn-rm" onclick="rmDenetci(${dCount})">Ã—</button>`;
  list.appendChild(d);
  dCount++;
  if (dCount >= 5) document.getElementById('btn-add-d').style.opacity = '.4';
}
function rmDenetci(i) {
  const el = document.getElementById(`d-${i}`);
  if (el) el.remove();
  dCount--;
  document.getElementById('btn-add-d').style.opacity = '1';
  document.querySelectorAll('#denetci-list .imza-item').forEach((el,j) => {
    el.id = `d-${j}`;
    el.querySelector('label').textContent = `DenetÃ§i ${j+1}`;
    const b = el.querySelector('.btn-rm');
    if (b) b.setAttribute('onclick', `rmDenetci(${j})`);
  });
}
function getDenetciler() {
  return [...document.querySelectorAll('#denetci-list input')].map(i=>i.value.trim()).filter(Boolean);
}

// â”€â”€ SES TANIMA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startDic(field) {
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SR) { alert('LÃ¼tfen Chrome kullanÄ±n.'); return; }
  const el = document.getElementById(field === 'konu' ? 'f-konu' : 'f-notlar');
  const curPos = typeof el.selectionStart === 'number' ? el.selectionStart : el.value.length;
  let before = el.value.substring(0, curPos);
  const after = el.value.substring(curPos);
  if (before.length > 0 && !before.endsWith(' ') && !before.endsWith('\n')) before += ' ';
  let added = '';

  function makeRec() {
    const r = new SR();
    r.lang = 'tr-TR'; r.continuous = false; r.interimResults = true;
    r.onresult = (e) => {
      let interim = '';
      for (let i = e.resultIndex; i < e.results.length; i++) {
        if (e.results[i].isFinal) added += e.results[i][0].transcript + ' ';
        else interim += e.results[i][0].transcript;
      }
      el.value = before + added + interim + (interim ? '' : after);
      const cur = (before + added + interim).length;
      try { el.setSelectionRange(cur, cur); } catch(e) {}
      if (el.tagName === 'TEXTAREA') el.scrollTop = el.scrollHeight;
    };
    r.onerror = (e) => { if (e.error !== 'no-speech') stopDic(field); };
    r.onend = () => {
      el.value = before + added + after;
      if (recs[field]) { recs[field] = makeRec(); recs[field].start(); }
    };
    return r;
  }

  recs[field] = makeRec();
  recs[field].start();
  document.getElementById(`ms-${field}`).style.display = 'none';
  document.getElementById(`mp-${field}`).style.display = 'flex';
  document.getElementById(`ri-${field}`).classList.add('on');
}

function stopDic(field) {
  if (recs[field]) { recs[field].stop(); recs[field] = null; }
  document.getElementById(`ms-${field}`).style.display = 'flex';
  document.getElementById(`mp-${field}`).style.display = 'none';
  document.getElementById(`ri-${field}`).classList.remove('on');
}

// â”€â”€ DOCX OLUÅTUR (dÄ±ÅŸ kÃ¼tÃ¼phane yok) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Minimal OOXML/docx oluÅŸturucu
function metinSatir(metin, bold=false, center=false, size=24) {
  const alignment = center ? `<w:jc w:val="center"/>` : '';
  const boldTag = bold ? '<w:b/>' : '';
  return `<w:p><w:pPr>${alignment}</w:pPr><w:r><w:rPr>${boldTag}<w:sz w:val="${size}"/><w:szCs w:val="${size}"/></w:rPr><w:t xml:space="preserve">${xmlEscape(metin)}</w:t></w:r></w:p>`;
}

function xmlEscape(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function docxOlustur(tarih, konu, baskani, denetciler, denetlenen, notlar) {
  const satirlar = [
    metinSatir('T.C.', true, true, 28),
    metinSatir('PENDÄ°K KAYMAKAMLIÄI', true, true, 28),
    metinSatir('Ä°lÃ§e SaÄŸlÄ±k MÃ¼dÃ¼rlÃ¼ÄŸÃ¼', false, true, 24),
    metinSatir('', false, false, 24),
    metinSatir('DENETÄ°M TUTANAÄI', true, true, 32),
    metinSatir('', false, false, 24),
    metinSatir(`Tarih: ${tarih}`, false, false, 24),
    metinSatir(`Konu: ${konu}`, false, false, 24),
    metinSatir('', false, false, 24),
    metinSatir('DENETÄ°M NOTLARI:', true, false, 24),
    metinSatir('', false, false, 24),
  ];

  notlar.split('\n').forEach(satir => {
    satirlar.push(metinSatir(satir || ' ', false, false, 24));
  });

  satirlar.push(metinSatir('', false, false, 24));
  satirlar.push(metinSatir('', false, false, 24));
  satirlar.push(metinSatir('', false, false, 24));
  satirlar.push(metinSatir('Denetim Ekip BaÅŸkanÄ±', true, false, 22));
  satirlar.push(metinSatir(baskani, false, false, 22));
  satirlar.push(metinSatir('', false, false, 22));

  denetciler.forEach((d, i) => {
    satirlar.push(metinSatir(`DenetÃ§i ${i+1}`, true, false, 22));
    satirlar.push(metinSatir(d, false, false, 22));
    satirlar.push(metinSatir('', false, false, 22));
  });

  satirlar.push(metinSatir('Denetlenen', true, false, 22));
  satirlar.push(metinSatir(denetlenen, false, false, 22));

  const documentXml = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">
<w:body>${satirlar.join('')}<w:sectPr/></w:body>
</w:document>`;

  const relsXml = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
<Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="word/document.xml"/>
</Relationships>`;

  const wordRelsXml = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
</Relationships>`;

  const contentTypesXml = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>
<Default Extension="xml" ContentType="application/xml"/>
<Override PartName="/word/document.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"/>
</Types>`;

  return { documentXml, relsXml, wordRelsXml, contentTypesXml };
}

// â”€â”€ ZIP OLUÅTUR (JSZip yÃ¼kle) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function kaydet() {
  const btn = document.getElementById('btn-save');
  const st  = document.getElementById('status');
  const notlar = document.getElementById('f-notlar').value.trim();

  if (!notlar) {
    st.className = 'status err';
    st.textContent = 'âš ï¸ LÃ¼tfen denetim notlarÄ±nÄ± girin.';
    return;
  }

  btn.disabled = true;
  btn.textContent = 'â³ HazÄ±rlanÄ±yor...';
  st.className = 'status';

  try {
    // JSZip yÃ¼kle - docx aslÄ±nda bir ZIP dosyasÄ±dÄ±r
    await new Promise((res, rej) => {
      if (window.JSZip) { res(); return; }
      const s = document.createElement('script');
      s.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
      s.onload = res; s.onerror = rej;
      document.head.appendChild(s);
    });

    const tarih      = document.getElementById('f-tarih').value || '';
    const konu       = document.getElementById('f-konu').value || '';
    const baskani    = document.getElementById('f-baskani').value || '';
    const denetlenen = document.getElementById('f-denetlenen').value || '';
    const denetciler = getDenetciler();
    const tarihStr   = tarih ? new Date(tarih).toLocaleDateString('tr-TR') : '';

    const { documentXml, relsXml, wordRelsXml, contentTypesXml } = docxOlustur(
      tarihStr, konu, baskani, denetciler, denetlenen,
      document.getElementById('f-notlar').value
    );

    const zip = new JSZip();
    zip.file('[Content_Types].xml', contentTypesXml);
    zip.file('_rels/.rels', relsXml);
    zip.file('word/document.xml', documentXml);
    zip.file('word/_rels/document.xml.rels', wordRelsXml);

    const blob = await zip.generateAsync({ type: 'blob', mimeType: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' });

    const dateStr  = (tarih||new Date().toISOString().slice(0,10)).replace(/-/g,'');
    const baseName = `Tutanak_${dateStr}_${(baskani||'Denetim').replace(/\s+/g,'_')}`;
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `${baseName}.docx`;
    document.body.appendChild(a); a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    st.className = 'status ok';
    st.textContent = `âœ… "${baseName}.docx" indirildi!`;

    setTimeout(() => {
      if (confirm('Yeni tutanak oluÅŸturmak ister misiniz?')) {
        ['f-konu','f-notlar','f-baskani','f-denetlenen'].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.value = '';
        });
        document.querySelectorAll('#denetci-list input').forEach(i => i.value = '');
        document.getElementById('f-tarih').value = new Date().toISOString().split('T')[0];
        st.className = 'status';
      }
    }, 1500);

  } catch(err) {
    console.error(err);
    st.className = 'status err';
    st.textContent = 'âŒ Hata: ' + err.message;
  }

  btn.disabled = false;
  btn.textContent = 'ğŸ“¥ TutanaÄŸÄ± Ä°ndir (.docx)';
}
</script>
</body>
</html>
